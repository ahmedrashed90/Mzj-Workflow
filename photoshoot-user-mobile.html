
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <meta name="color-scheme" content="light"/>
  <title>إدارة الطلبات — MZJ Workspace</title>

  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>

  <style id="noFlash">
  html{background:#fff8ef}body{opacity:0;transition:.14s ease}
  </style>

  <style>
    :root{
      --brown:#3e2420; --beige:#bc8f74; --cream:#fff8ef;
      --text:#111827; --muted:#6b7280; --line:#e5e7eb;
      --card:#ffffff; --shadow:0 10px 24px rgba(0,0,0,.06);
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Tajawal",system-ui,Arial;
      background:var(--cream);
      color:var(--text);
      overflow-x:hidden;
    }

    /* ===== Top Bar ===== */
    .topbar{
      position:sticky;
      top:0;
      z-index:50;
      background:#fff;
      border-bottom:1px solid var(--line);
    }
    .topbar .row{
      max-width:1100px;
      margin:0 auto;
      padding:12px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .title{display:flex;flex-direction:column;gap:2px;min-width:0}
    .title b{
      color:var(--brown);
      font-size:16px;
      line-height:1.2;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }
    .title span{
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }
    .chip{
      display:flex;align-items:center;gap:8px;
      border:1px solid var(--line);
      background:#fff;
      padding:8px 10px;
      border-radius:999px;
      box-shadow:var(--shadow);
      font-size:12px;
      flex-shrink:0;
      max-width:48vw;
      overflow:hidden;
    }
    .dot{width:10px;height:10px;border-radius:999px;background:#f59e0b;}
    .dot.ok{background:#16a34a}
    .dot.err{background:#ef4444}
    .dot.warn{background:#f59e0b}

    /* ===== Page ===== */
    .page{
      max-width:1100px;
      margin:0 auto;
      padding:14px 12px 120px; /* space for bottom bar */
    }

    /* ===== Bottom Nav ===== */
    .bottom{
      position:fixed;
      left:0; right:0; bottom:0;
      background:#fff;
      border-top:1px solid var(--line);
      padding:10px 10px calc(10px + env(safe-area-inset-bottom));
      z-index:60;
    }
    .bottom .wrap{
      max-width:1100px;
      margin:0 auto;
      display:grid;
      grid-template-columns:repeat(4,1fr); /* 8 items => 2 rows */
      gap:8px;
    }
    .navbtn{
      border:1px solid transparent;
      background:#fff;
      border-radius:16px;
      padding:10px 6px;
      display:grid;
      place-items:center;
      gap:6px;
      color:#111;
      text-decoration:none;
      font-weight:800;
      font-size:12px;
      line-height:1.1;
      user-select:none;
    }
    .navbtn i{color:var(--beige);font-size:18px}
    .navbtn.active{
      background:var(--cream);
      border-color:var(--line);
      color:var(--brown);
    }
    @media (max-width:420px){
      .navbtn{padding:9px 4px;font-size:11px}
      .navbtn i{font-size:17px}
    }

    /* ===== Page CSS ===== */
    
:root{
  --brown:#3e2420;
  --beige:#e8d6c8;
  --cream:#fff8ef;
  --text:#1f2937;
  --muted:#6b7280;
  --line:#ead9cc;
  --card:#ffffff;
  --radius:14px;
  --ok:#0f5132;
  --okbg:#f3fff6;
  --warn:#7a1010;
  --warnbg:#fff5f5;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:'Tajawal', sans-serif;
  background:var(--cream);
  color:var(--text);
}

/* =======================
   TOP BAR (كما طلبت)
======================= */
.dashboard-topbar{
  background:#fff;
  border-bottom:1px solid var(--beige);
  padding:14px 20px;
  position:sticky;
  top:0;
  z-index:50;
}
.dashboard-tabs{
  display:flex;
  gap:10px;
  overflow-x:auto;
  white-space:nowrap;
}
.dashboard-tabs::-webkit-scrollbar{height:4px}
.dashboard-tabs::-webkit-scrollbar-thumb{
  background:#dcc3b2;
  border-radius:10px;
}
.dashboard-tab{
  padding:10px 18px;
  border-radius:999px;
  border:1px solid var(--beige);
  background:#fff;
  color:var(--brown);
  font-size:14px;
  font-weight:500;
  line-height:1;
  white-space:nowrap;
  cursor:pointer;
  transition:all .2s ease;
}
.dashboard-tab:hover{background:#f6eee7}
.dashboard-tab.active{
  background:var(--brown);
  color:#fff;
  border-color:var(--brown);
}

.container{max-width:1600px;margin:18px auto;padding:0 12px 60px}
@media (min-width:1200px){ .container{max-width:95vw;} }
/* توسيع صفحة الطلبات */
#page-orders{max-width:100%;}
#page-orders .card{max-width:100%;}
#inner-create .table{min-width:1500px;}

.card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:var(--radius);
  box-shadow:0 10px 26px rgba(62,36,32,.06);
}
.card-hd{
  padding:14px 16px;
  border-bottom:1px solid var(--line);
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:space-between;
  flex-wrap:wrap;
}
.card-hd h2{margin:0;font-size:16px;font-weight:900;color:var(--brown)}
.card-bd{padding:14px 16px}

.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.spacer{flex:1}

.badge{
  display:inline-flex;align-items:center;gap:8px;
  padding:8px 10px;border-radius:999px;font-size:13px;
  border:1px solid var(--line);background:#fff;color:var(--brown);
}
.small{font-size:12px;color:var(--muted)}

.btn{
  border:1px solid var(--line);
  background:#fff;
  color:var(--brown);
  border-radius:12px;
  padding:10px 12px;
  font-weight:900;
  cursor:pointer;
  transition:.15s ease;
  display:inline-flex;
  gap:8px;
  align-items:center;
  justify-content:center;
}
.btn:hover{background:#f7f0ea}
.btn.primary{background:var(--brown);border-color:var(--brown);color:#fff}
.btn.primary:hover{filter:brightness(.95)}
.btn.danger{background:#b42318;border-color:#b42318;color:#fff}
.btn.danger:hover{filter:brightness(.95)}
.btn[disabled]{opacity:.55;cursor:not-allowed}

.input,.select, .small-input{
  padding:10px 12px;border-radius:12px;border:1px solid var(--line);
  background:#fff;min-width:220px;
  font-family:inherit;
}
.small-input{min-width:0;padding:8px 10px;border-radius:10px;font-size:13px}
/* ===== Create table compact mode ===== */
#inner-create .table th, #inner-create .table td{font-size:12px;padding:6px 8px}
#inner-create .small-input{padding:6px 8px;font-size:12px;border-radius:8px}
#inner-create .req-vin{width:70px}
#inner-create .req-year{width:70px}
#inner-create .req-ext,#inner-create .req-int{width:60px}
#inner-create .req-location{width:250px}
#inner-create .req-place{width:250px}
.mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
.center{text-align:center}

.hr{height:1px;background:var(--line);margin:12px 0}

.alert{margin-top:10px;padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:#fff;color:var(--text);font-size:13px}
.alert.err{border-color:#f2b8b5;background:var(--warnbg);color:var(--warn)}
.alert.ok{border-color:#b7e3c5;background:var(--okbg);color:var(--ok)}

.tableWrap{overflow:auto;border:1px solid var(--line);border-radius:12px}
.table{width:100%;border-collapse:collapse}
.table th,.table td{
  padding:10px 10px;
  border-bottom:1px solid var(--line);
  font-size:13px;
  vertical-align:middle;
  background:#fff;
}
.table th{background:#faf6f2;color:var(--brown);font-weight:900}
.table tr:last-child td{border-bottom:none}
.muted{color:var(--muted)}

/* Inner tabs */
.inner-tabs{display:flex;gap:10px;flex-wrap:wrap}
.inner-tab{
  padding:10px 14px;border-radius:999px;border:1px solid var(--line);
  background:#fff;color:var(--brown);font-weight:900;cursor:pointer;
}
.inner-tab.active{background:var(--brown);border-color:var(--brown);color:#fff}

/* Modal */
.modal-backdrop{
  position:fixed;inset:0;background:rgba(0,0,0,.35);
  display:none;align-items:center;justify-content:center;z-index:1000;padding:18px;
}
.modal{
  width:min(1100px, 100%);
  max-height:92vh;
  overflow:auto;
  background:#fff;
  border-radius:18px;
  border:1px solid var(--line);
  box-shadow:0 20px 60px rgba(0,0,0,.25);
}
.modal-hd{
  padding:14px 16px;
  border-bottom:1px solid var(--line);
  display:flex;align-items:center;gap:10px;justify-content:space-between;
  flex-wrap:wrap;
}
.modal-hd .title{font-weight:900;color:var(--brown);font-size:16px}
.modal-bd{padding:14px 16px}
.modal-ft{
  padding:12px 12px;
  border-top:1px solid var(--line);
  background:#faf6f2;
}
.ft-grid{display:grid;grid-template-columns:repeat(6,minmax(0,1fr));gap:10px}
@media (max-width:920px){.ft-grid{grid-template-columns:repeat(3,minmax(0,1fr))}}
@media (max-width:520px){.ft-grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
.ft-btn{width:100%;border-radius:14px;padding:12px 10px}

/* Progress */
.progress-wrap{padding:12px;border:1px solid var(--line);border-radius:14px;background:#fff}
.progress-row{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:8px}
.progress-row .p-title{font-weight:900;color:var(--brown);font-size:13px}
.progress-row .p-val{color:var(--muted);font-size:12px}
.bar{height:10px;background:#f2e8e0;border-radius:999px;overflow:hidden}
.bar>div{height:100%;background:var(--brown);width:0%;transition:width .2s ease}
.stage-grid{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px;margin-top:10px}
@media (max-width:920px){.stage-grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
.stage{border:1px solid var(--line);border-radius:14px;padding:10px;background:#fff}
.stage .s-title{font-weight:900;color:var(--brown);font-size:12px}
.stage .s-val{color:var(--muted);font-size:12px;margin-top:4px}

/* ===== منع الاسكرول الأفقي وجعل الجدول يدخل الشاشة ===== */
#inner-create .tableWrap{
  overflow-x: hidden;
  overflow-y: visible;
}

#inner-create table{
  table-layout: fixed;
  width:100%;
}

#inner-create th,
#inner-create td{
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* تصغير الأعمدة الثانوية */
#inner-create .req-ext,
#inner-create .req-int,
#inner-create .req-year{
  max-width:60px;
}

#inner-create .req-note{
  max-width:90px;
}

#inner-create .req-place,
#inner-create .req-location{
  max-width:250px;
}

/* VIN والسيارة */
#inner-create th:nth-child(3),
#inner-create td:nth-child(3){
  width:90px;
}

#inner-create th:nth-child(4),
#inner-create td:nth-child(4){
  width:auto;
}


/* ===== ضبط تركيب جدول إنشاء الطلب (بدون اسكرول) ===== */
#inner-create .tableWrap{ overflow: hidden; }

/* خلي الجدول يرتب نفسه بشكل أنضف */
#inner-create table{
  table-layout: fixed;
  width:100%;
}

/* الهيدر ما ينقصش (ممنوع ellipsis في العناوين) */
#inner-create th{
  white-space: normal !important;
  overflow: visible !important;
  text-overflow: clip !important;
  line-height: 1.15;
}

/* الخلايا تفضل مضغوطة لكن من غير ما تقص الهيدر */
#inner-create td{
  white-space: nowrap;
}

/* المدخلات تاخد عرض الخلية بالكامل */
#inner-create .small-input,
#inner-create .input,
#inner-create .select{
  width: 100% !important;
  min-width: 0 !important;
}

/* توزيع أعمدة ثابت ومرتب */
#inner-create .table th:nth-child(1), #inner-create .table td:nth-child(1){width:50px}   /* # */
#inner-create .table th:nth-child(2), #inner-create .table td:nth-child(2){width:110px}  /* نوع */
#inner-create .table th:nth-child(3), #inner-create .table td:nth-child(3){width:95px}   /* VIN */
#inner-create .table th:nth-child(4), #inner-create .table td:nth-child(4){width:220px}  /* السيارة */
#inner-create .table th:nth-child(5), #inner-create .table td:nth-child(5){width:200px}  /* الفئة */
#inner-create .table th:nth-child(6), #inner-create .table td:nth-child(6){width:80px}   /* الخارجي */
#inner-create .table th:nth-child(7), #inner-create .table td:nth-child(7){width:80px}   /* الداخلي */
#inner-create .table th:nth-child(8), #inner-create .table td:nth-child(8){width:80px}   /* الموديل */
#inner-create .table th:nth-child(9), #inner-create .table td:nth-child(9){width:250px}  /* المكان */
#inner-create .table th:nth-child(10),#inner-create .table td:nth-child(10){width:250px} /* مكان التصوير/النقل */
#inner-create .table th:nth-child(11),#inner-create .table td:nth-child(11){width:120px} /* ملاحظة */
#inner-create .table th:nth-child(12),#inner-create .table td:nth-child(12){width:70px}  /* مسح */

/* تحسين شكل الصف */
#inner-create .table th, #inner-create .table td{ padding:6px 8px; }
#inner-create .small-input{ height:30px; }

/* على الشاشات الأضيق نخفي أعمدة ثانوية عشان “تركب كويس” */
@media (max-width: 1320px){
  #inner-create .table th:nth-child(6), #inner-create .table td:nth-child(6),
  #inner-create .table th:nth-child(7), #inner-create .table td:nth-child(7){
    display:none;
  }
}
@media (max-width: 1180px){
  #inner-create .table th:nth-child(8), #inner-create .table td:nth-child(8){
    display:none;
  }
}


/* ===== ضبط أحجام (السيارة / الفئة / المكان / مكان التصوير) ===== */
/* تصغير السيارة والفئة */
#inner-create .table th:nth-child(4),
#inner-create .table td:nth-child(4),  /* السيارة */
#inner-create .table th:nth-child(5),
#inner-create .table td:nth-child(5){  /* الفئة */
  width:180px !important;
}

/* تكبير المكان ومكان التصوير وجعلهم نفس الحجم */
#inner-create .table th:nth-child(9),
#inner-create .table td:nth-child(9),   /* المكان */
#inner-create .table th:nth-child(10),
#inner-create .table td:nth-child(10){  /* مكان التصوير */
  width:100px !important;
}


/* ===== وضوح الداتا (السيارة + الفئة) ===== */

/* السماح بكسر السطر للسيارة والفئة */
#inner-create .table td:nth-child(4),
#inner-create .table td:nth-child(5){
  white-space: normal !important;
  line-height: 1.35;
}

/* تكبير ارتفاع الصف تلقائيًا عند وجود نص طويل */
#inner-create .table td{
  vertical-align: middle;
}

/* inputs داخل السيارة والفئة تكسر سطر */
#inner-create .table td:nth-child(4) input,
#inner-create .table td:nth-child(5) input{
  white-space: normal;
  height: auto;
  padding-top: 6px;
  padding-bottom: 6px;
}

/* تقليل القص (ellipsis) في الأعمدة المهمة */
#inner-create .table td{
  text-overflow: clip;
}

/* تحسين تباعد النص */
#inner-create .small-input{
  line-height: 1.4;
}


/* ===== ضبط أحجام الأعمدة + توحيد (العنوان + المربع) ===== */
/* ضمان إن الـ input / select يملوا الخلية */
#inner-create .small-input,
#inner-create .input,
#inner-create .select{
  width:100% !important;
  min-width:0 !important;
}

/* توحيد عرض (السيارة) عنوان + مربع */
#inner-create .table th:nth-child(4),
#inner-create .table td:nth-child(4){
  width: 240px !important;
}

/* توحيد عرض (الفئة) عنوان + مربع */
#inner-create .table th:nth-child(5),
#inner-create .table td:nth-child(5){
  width: 240px !important;
}

/* تكبير الخارجي + الداخلي */
#inner-create .table th:nth-child(6),
#inner-create .table td:nth-child(6),
#inner-create .table th:nth-child(7),
#inner-create .table td:nth-child(7){
  width: 95px !important;
}

/* تكبير المكان */
#inner-create .table th:nth-child(9),
#inner-create .table td:nth-child(9){
  width: 100px !important;
}

/* تكبير مكان التصوير/النقل */
#inner-create .table th:nth-child(10),
#inner-create .table td:nth-child(10){
  width: 100px !important;
}

/* تحسين قراءة السيارة والفئة بدون ما تبهدل الصف */
#inner-create .table td:nth-child(4),
#inner-create .table td:nth-child(5){
  white-space: normal !important;
  line-height: 1.35;
}
#inner-create .table td:nth-child(4) input,
#inner-create .table td:nth-child(5) input{
  white-space: normal;
  height: auto;
}


/* ===== تثبيت: مسميات الأعمدة = نفس عرض مربعات الداتا + VIN كامل ===== */
/* خريطة أعمدة إنشاء الطلب (12 عمود) */
/* # | نوع | VIN | السيارة | الفئة | الخارجي | الداخلي | الموديل | المكان | مكان التصوير/النقل | ملاحظة | مسح */
#inner-create .table th:nth-child(1), #inner-create .table td:nth-child(1){width:50px !important;}
#inner-create .table th:nth-child(2), #inner-create .table td:nth-child(2){width:120px !important;}
#inner-create .table th:nth-child(3), #inner-create .table td:nth-child(3){width:100px !important;} /* VIN أكبر */
#inner-create .table th:nth-child(4), #inner-create .table td:nth-child(4){width:240px !important;}
#inner-create .table th:nth-child(5), #inner-create .table td:nth-child(5){width:240px !important;}
#inner-create .table th:nth-child(6), #inner-create .table td:nth-child(6){width:105px !important;} /* خارجي */
#inner-create .table th:nth-child(7), #inner-create .table td:nth-child(7){width:105px !important;} /* داخلي */
#inner-create .table th:nth-child(8), #inner-create .table td:nth-child(8){width:90px !important;}
#inner-create .table th:nth-child(9), #inner-create .table td:nth-child(9){width:100px !important;} /* المكان أكبر */
#inner-create .table th:nth-child(10),#inner-create .table td:nth-child(10){width:100px !important;} /* مكان التصوير أكبر */
#inner-create .table th:nth-child(11),#inner-create .table td:nth-child(11){width:140px !important;}
#inner-create .table th:nth-child(12),#inner-create .table td:nth-child(12){width:70px !important;}

/* العناوين ما تتقصش */
#inner-create .table th{
  white-space: nowrap !important;
  overflow: visible !important;
  text-overflow: clip !important;
}

/* VIN ما يتقصش أبداً */
#inner-create .table td:nth-child(3){
  overflow: visible !important;
  text-overflow: clip !important;
}
#inner-create .table td:nth-child(3) input{
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  letter-spacing: .3px;
  white-space: nowrap;
}

/* باقي الخلايا تفضل منظمة */
#inner-create .table td{
  overflow: hidden;
}


/* ===== تصغير إطار VIN + إطار (السيارة/الفئة) ومحاذاة موحدة ===== */

/* نفس ارتفاع ومحاذاة كل مربعات الصف */
#inner-create .table td{
  vertical-align: middle !important;
}

/* صغّر VIN (الإطار نفسه) */
#inner-create .table td:nth-child(3) input{
  height: 30px !important;
  padding: 5px 8px !important;
  font-size: 12px !important;
  border-radius: 8px !important;
}

/* صغّر إطار السيارة + الفئة بنفس شكل VIN (لكن يفضلوا أعرض) */
#inner-create .table td:nth-child(4) input,
#inner-create .table td:nth-child(5) input{
  height: 30px !important;
  padding: 5px 8px !important;
  font-size: 12px !important;
  border-radius: 8px !important;
}

/* خلي نص السيارة/الفئة يتلف (wrap) داخل نفس الإطار بدون ما يبوّظ المحاذاة */
#inner-create .table td:nth-child(4) input,
#inner-create .table td:nth-child(5) input{
  white-space: normal !important;
  line-height: 1.25 !important;
}


/* ===== تصغير إضافي لإطارات VIN / السيارة / الفئة ===== */

/* VIN أصغر */
#inner-create .table td:nth-child(3) input{
  height: 30px !important;
  padding: 4px 6px !important;
  font-size: 11px !important;
  border-radius: 7px !important;
}

/* السيارة + الفئة أصغر وبنفس المحاذاة */
#inner-create .table td:nth-child(4) input,
#inner-create .table td:nth-child(5) input{
  height: 30px !important;
  padding: 4px 6px !important;
  font-size: 11px !important;
  border-radius: 7px !important;
  line-height: 1.2 !important;
}

/* ===== تكبير المكان + مكان التصوير ===== */

/* المكان */
#inner-create .table td:nth-child(9) input{
  height: 30px !important;
  padding: 6px 10px !important;
  font-size: 12px !important;
  border-radius: 10px !important;
}

/* مكان التصوير / النقل */
#inner-create .table td:nth-child(10) select{
  height: 30px !important;
  padding: 6px 10px !important;
  font-size: 12px !important;
  border-radius: 10px !important;
}

/* محاذاة عمودية موحدة */
#inner-create .table td{
  vertical-align: middle !important;
}


/* ===============================
   الحل النهائي: العناوين فوق المربعات 1:1
   + تصغير (السيارة/الفئة)
   + تكبير (المكان/مكان التصوير/ملاحظة)
================================ */

/* تأكيد إن الهيدر والخلية نفس العرض */
#inner-create .table th,
#inner-create .table td{
  box-sizing: border-box;
}

/* توحيد عرض كل input/select مع العمود */
#inner-create .table td input,
#inner-create .table td select{
  width:100% !important;
  min-width:0 !important;
}

/* ===== السيارة + الفئة (أصغر) ===== */
#inner-create .table th:nth-child(4),
#inner-create .table td:nth-child(4),
#inner-create .table th:nth-child(5),
#inner-create .table td:nth-child(5){
  width: 180px !important;
}

#inner-create .table td:nth-child(4) input,
#inner-create .table td:nth-child(5) input{
  height: 30px !important;
  font-size: 11px !important;
  padding: 4px 6px !important;
  line-height: 1.2;
}

/* ===== المكان + مكان التصوير + ملاحظة (أكبر) ===== */
#inner-create .table th:nth-child(9),
#inner-create .table td:nth-child(9){
  width: 150px !important;
}

#inner-create .table th:nth-child(10),
#inner-create .table td:nth-child(10){
  width: 150px !important;
}

#inner-create .table th:nth-child(11),
#inner-create .table td:nth-child(11){
  width: 200px !important;
}

#inner-create .table td:nth-child(9) input,
#inner-create .table td:nth-child(10) select,
#inner-create .table td:nth-child(11) input{
  height: 30px !important;
  font-size: 12px !important;
  padding: 6px 10px !important;
}

/* منع قص العناوين */
#inner-create .table th{
  white-space: nowrap;
  text-align: center;
}


/* ===== Create Table: labels فوق المربعات داخل نفس الخلية ===== */
#inner-create thead{display:none !important;}
#inner-create .cell{display:flex;flex-direction:column;gap:6px}
#inner-create .cell label{font-size:12px;font-weight:700;color:var(--brown);line-height:1.1;text-align:right}
#inner-create .cell input,#inner-create .cell select{width:100% !important;min-width:0 !important}
#inner-create .table td{padding:10px 8px !important;vertical-align:top !important}
#inner-create .cell.actions{align-items:center}
#inner-create .cell.actions label{text-align:center;width:100%}


/* ===== Topbar links (Tabs) ===== */
.dashboard-tabs{display:flex;gap:10px;overflow-x:auto;white-space:nowrap}
.dashboard-tabs::-webkit-scrollbar{height:4px}
.dashboard-tabs::-webkit-scrollbar-thumb{background:#dcc3b2;border-radius:10px}
.tab{
  padding:10px 18px;
  border-radius:999px;
  border:1px solid var(--beige);
  background:#fff;
  color:var(--brown);
  font-size:14px;
  font-weight:700;
  line-height:1;
  white-space:nowrap;
  text-decoration:none;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  transition:all .2s ease;
}
.tab:hover{background:#f6eee7}
.tab.active{background:var(--brown);color:#fff;border-color:var(--brown)}
/* إلغاء اعتماد dashboard-tab */
.dashboard-tab{display:none !important;}


/* منع وميض تسجيل الدخول أثناء التحقق */
body.auth-checking #loginCard{display:none !important;}


/* إخفاء تبويبات الإدارة لغير الإدارة */


  /* ===== Visual helper for مسئول التنفيذ ===== */
  .row-turn td{background:#ecfdf3 !important;}
  .turn-badge{
    display:inline-flex;align-items:center;gap:6px;
    padding:6px 10px;border-radius:999px;
    border:1px solid #bbf7d0;background:#ecfdf3;
    color:#14532d;font-weight:800;font-size:12px;
    white-space:nowrap;
  }
  .turn-badge.wait{
    border-color:#fed7aa;background:#fff7ed;color:#9a3412;
  }

  </style>
</head>
<body data-page="photoshoot-user-mobile.html">

<header class="topbar">
  <div class="row">
    <div class="title">
      <b>إدارة الطلبات</b>
      <span>طلبات التصوير والنقل — نسخة موبايل</span>
    </div>
    <div class="chip" title="حالة الاتصال">
      <span class="dot warn" id="connDot"></span>
      <span id="connText">جارِ الاتصال…</span>
    </div>
  </div>
</header>

<div id="authGate" style="display:none"></div>
<div id="app">
<main class="page" id="pageRoot">
  <div class="container">



  <!-- LOGIN CARD -->
  <div class="card" id="loginCard" style="display:none">
    <div class="card-hd">
      <h2>تسجيل الدخول</h2>
      <div class="row">
        <span class="badge" id="authState">جارٍ الاتصال…</span>
        <span class="badge" id="roleBadge">—</span>
        <span class="badge" id="locBadge">—</span>
        <button class="btn" id="btnLogout" style="display:none"><i class="fa-solid fa-right-from-bracket"></i>تسجيل خروج</button>
      </div>
    </div>
    <div class="card-bd">
      <div class="row">
        <input class="input" id="loginEmail" type="email" placeholder="البريد الإلكتروني" autocomplete="email">
        <input class="input" id="loginPass" type="password" placeholder="كلمة المرور" autocomplete="current-password">
        <button class="btn primary" id="btnLogin"><i class="fa-solid fa-right-to-bracket"></i>تسجيل الدخول</button>
      </div>
      <div class="alert" id="loginMsg" style="display:none"></div>
      <div class="small" style="margin-top:8px">يفتح فقط من خلال https أو localhost (مش file://).</div>
    </div>
  </div>

  <!-- ORDERS PAGE -->
  <div class="card" id="page-orders" style="display:none; margin-top:14px">
    <div class="card-hd">
      <h2>الطلبات</h2>
      <div class="inner-tabs">
        <button class="inner-tab active" data-inner="create">إنشاء طلب</button>
        <button class="inner-tab" data-inner="manage">إدارة الطلبات</button>
        <button class="inner-tab" data-inner="done">الطلبات المكتملة</button>
      </div>
    </div>

    <!-- Create -->
    <div class="card-bd" id="inner-create">
      <div class="row">
        <input class="input" id="reqBy" placeholder="مقدم الطلب" readonly>
        <select class="select" id="reqType">
          <option value="auto" selected>تحديد تلقائي من الصفوف</option>
          <option value="shoot">تصوير فقط</option>
          <option value="move">نقل فقط</option>
        </select>
        <button class="btn" id="btnAddRow"><i class="fa-solid fa-plus"></i>إضافة سيارة</button>
        <button class="btn" id="btnResetRows"><i class="fa-solid fa-rotate"></i>إعادة ضبط الجدول</button>
        <span class="spacer"></span>
        <button class="btn primary" id="btnSubmit"><i class="fa-solid fa-paper-plane"></i>ارسال الطلب</button>
      </div>

      <div class="hr"></div>

      

      <div class="tableWrap" style="margin-top:10px">
        <table class="table">
          <thead>
            <tr>
              <th style="width:60px" class="center">#</th>
              <th style="width:120px">نوع</th>
              <th style="width:60px">VIN</th>
              <th>السيارة</th>
              <th>الفئة</th>
              <th style="width:40px">الخارجي</th>
              <th style="width:40px">الداخلي</th>
              <th style="width:90px" class="center">الموديل</th>
              <th style="width:120px">المكان</th>
              <th style="width:120px" id="placeHeader">مكان التصوير</th>
              <th style="width:80px">ملاحظة</th>
              <th style="width:70px" class="center">مسح</th>
            </tr>
          </thead>
          <tbody id="reqRowsBody"></tbody>
        </table>
      </div>
    </div>

    <!-- Manage -->
    <div class="card-bd" id="inner-manage" style="display:none">
      <div class="row">
        <select class="select" id="filterKind">
          <option value="all">الكل</option>
          <option value="shoot">تصوير</option>
          <option value="move">نقل</option>
          <option value="mixed">مختلط</option>
        </select>
        <input class="input" id="searchBox" placeholder="بحث: رقم الطلب / المنشئ / VIN">
        <span class="spacer"></span>
        <span class="badge" id="manageCount">—</span>
      </div>

      <div class="tableWrap" style="margin-top:10px">
        <table class="table">
          <thead>
            <tr>
              <th style="width:90px">رقم</th>
              <th style="width:90px">النوع</th>
              <th>الحالة</th>
              <th style="width:200px">المنشئ</th>
              <th style="width:170px">آخر تحديث</th>
              <th style="width:130px">إجراءات</th>
            </tr>
          </thead>
          <tbody id="ordersTbody"></tbody>
        </table>
      </div>
    </div>

    <!-- Done -->
    <div class="card-bd" id="inner-done" style="display:none">
      <div class="small">يعرض الطلبات المكتملة فقط.</div>
      <div class="tableWrap" style="margin-top:10px">
        <table class="table">
          <thead>
            <tr>
              <th style="width:90px">رقم</th>
              <th style="width:90px">النوع</th>
              <th style="width:200px">المنشئ</th>
              <th style="width:170px">وقت الإنهاء</th>
              <th style="width:130px">فتح</th>
            </tr>
          </thead>
          <tbody id="doneTbody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- CARS -->
  <div class="card" id="page-cars" style="display:none; margin-top:14px">
    <div class="card-hd"><h2>كل السيارات</h2><span class="small">مصدر الـ Auto-fill هو stock من mzj_admin_state/v1.</span></div>
    <div class="card-bd">
      <div class="row">
        <input class="input mono" id="vinLookup" placeholder="ابحث عن VIN">
        <button class="btn" id="btnLookup"><i class="fa-solid fa-magnifying-glass"></i>بحث</button>
        <span class="spacer"></span>
        <span class="badge" id="stockCount">—</span>
      </div>
      <div class="alert" id="lookupRes" style="display:none"></div>
    </div>
  </div>

  <!-- ACTIVITY -->
  <div class="card" id="page-activity" style="display:none; margin-top:14px">
    <div class="card-hd"><h2>سجل النشاط</h2><span class="small">مرئي للإدارة فقط</span></div>
    <div class="card-bd">
      <div class="small" id="activityHint">—</div>
      <div class="tableWrap" style="margin-top:10px">
        <table class="table">
          <thead><tr><th style="width:180px">الوقت</th><th style="width:200px">المستخدم</th><th>الإجراء</th><th>التفاصيل</th></tr></thead>
          <tbody id="activityTbody"></tbody>
        </table>
      </div>
    </div>
  </div>

</div>

<!-- MODAL -->
<div class="modal-backdrop" id="modalBackdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true">
    <div class="modal-hd">
      <div class="title" id="modalTitle">تفاصيل الطلب</div>
      <div class="row">
        <span class="badge" id="modalMeta">—</span>
        <button class="btn" id="btnCloseModal"><i class="fa-solid fa-xmark"></i>إغلاق</button>
      </div>
    </div>

    <div class="modal-bd">
      <div class="progress-wrap">
        <div class="progress-row"><div class="p-title">Progress عام</div><div class="p-val" id="overallVal">0%</div></div>
        <div class="bar"><div id="overallBar"></div></div>

        <div class="stage-grid">
          <div class="stage"><div class="s-title">1) تم استلام الطلب</div><div class="s-val" id="s1Val">0/0 — 0%</div><div class="bar" style="margin-top:6px"><div id="s1Bar"></div></div></div>
          <div class="stage"><div class="s-title">2) تم إرسال السيارة</div><div class="s-val" id="s2Val">0/0 — 0%</div><div class="bar" style="margin-top:6px"><div id="s2Bar"></div></div></div>
          <div class="stage"><div class="s-title">3) تم استلام السيارة</div><div class="s-val" id="s3Val">0/0 — 0%</div><div class="bar" style="margin-top:6px"><div id="s3Bar"></div></div></div>
          <div class="stage"><div class="s-title">4) تم الانتهاء</div><div class="s-val" id="s4Val">—</div><div class="bar" style="margin-top:6px"><div id="s4Bar"></div></div></div>
        </div>
      </div>

      <div class="hr"></div>

      <div class="tableWrap">
        <table class="table">
          <thead><tr>
            <th style="width:60px" class="center">#</th>
            <th style="width:140px">VIN</th>
            <th>السيارة</th>
            <th style="width:170px">المكان</th>
            <th style="width:170px">الوجهة</th>
            <th style="width:110px">النوع</th>
            <th style="width:160px">حالة التنفيذ</th>
            <th style="width:140px">دورك الآن</th>
            <th style="width:220px">تعديل الوجهة</th>
          </tr></thead>
          <tbody id="rowsTbody"></tbody>
        </table>
      </div>

      <div class="small" style="margin-top:10px" id="permHint">—</div>
    </div>

    <div class="modal-ft">
      <div class="ft-grid">
        <button class="btn ft-btn" id="btnEditReq"><i class="fa-solid fa-pen-to-square"></i>تعديل الطلب</button>
        <button class="btn primary ft-btn" id="btnStep1">1 تم استلام الطلب</button>
        <button class="btn primary ft-btn" id="btnStep2">2 تم إرسال السيارة</button>
        <button class="btn primary ft-btn" id="btnStep3">3 تم استلام السيارة</button>
        <button class="btn primary ft-btn" id="btnStep4"><i class="fa-solid fa-flag-checkered"></i>4 تم الانتهاء</button>
        <button class="btn ft-btn" id="btnRefreshModal"><i class="fa-solid fa-rotate"></i>تحديث</button>
      </div>
      <div class="small" style="margin-top:8px">ترتيب التنفيذ ثابت: 1 → 2 → 3 → 4 (الإنهاء لمقدم الطلب + الإدارة).</div>
    </div>
  </div>
</div>

<!-- Firebase (Compat) -->
</main>
<button id="btnSignOut" style="display:none" aria-hidden="true"></button>

<nav class="bottom" aria-label="التنقل">
  <div class="wrap">
    <a class="navbtn" data-href="admin-mobile.html" href="admin-mobile.html"><i class="fa-solid fa-shield-halved"></i><span>الإدارة</span></a>
    <a class="navbtn" data-href="inventory-mobile.html" href="inventory-mobile.html"><i class="fa-solid fa-boxes-stacked"></i><span>المخزون</span></a>
    <a class="navbtn" data-href="dashboard-mobile.html" href="dashboard-mobile.html"><i class="fa-solid fa-gauge"></i><span>الداش</span></a>
    <a class="navbtn" data-href="vt-mobile.html" href="vt-mobile.html"><i class="fa-solid fa-right-left"></i><span>نقل</span></a>

    <a class="navbtn" data-href="photoshoot-user-mobile.html" href="photoshoot-user-mobile.html"><i class="fa-solid fa-camera"></i><span>الطلبات</span></a>
    <a class="navbtn" data-href="cars-mobile.html" href="cars-mobile.html"><i class="fa-solid fa-car"></i><span>السيارات</span></a>
    <a class="navbtn" data-href="sales-mobile.html" href="sales-mobile.html"><i class="fa-solid fa-location-dot"></i><span>التتبع</span></a>
    <a class="navbtn" data-href="activity-mobile.html" href="activity-mobile.html"><i class="fa-solid fa-clipboard-list"></i><span>النشاط</span></a>
  </div>
</nav>

<script>
  // Active nav
  (function(){
    const current = location.pathname.split('/').pop();
    document.querySelectorAll('.navbtn').forEach(a=>{
      if((a.getAttribute('data-href')||a.getAttribute('href')) === current) a.classList.add('active');
    });
  })();
  // Safety: ensure page becomes visible even if app JS fails
  setTimeout(()=>{ const nf=document.getElementById('noFlash'); if(nf) nf.remove(); document.body.style.opacity='1'; }, 700);
</script>

<script type="module">

</script>



<script>
  // ✅ Status fallback (Mobile): لو الصفحة اشتغلت ومفيش تحديث حالة، نخليها "متصل"
  window.addEventListener('load', () => {
    const dot = document.getElementById('connDot');
    const text = document.getElementById('connText');
    if (dot && text && /جار|جارِ/.test(text.textContent || '')) {
      dot.classList.remove('warn','err');
      dot.classList.add('ok');
      text.textContent = 'متصل';
    }
  });
</script>


<script>
  // ✅ Force show #app on mobile (fallback): يمنع صفحة فاضية بسبب app.display=none
  window.addEventListener('load', () => {
    const app = document.getElementById('app');
    if (app && getComputedStyle(app).display === 'none') {
      app.style.display = 'block';
    }
  });
</script>

</body>
</html>
