
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>إدارة المبيعات | MZJ</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <!-- Optional: your global UI template (if present in same folder) -->
  <link rel="stylesheet" href="mzj-ui (1).css" />
  <link rel="stylesheet" href="sales.css" />
</head>

<body class="mzj-page">
  <!-- Topbar (simple fallback if mzj-ui is missing) -->
  <header class="mzj-topbar">
    <div class="mzj-topbar-left">
      <div class="mzj-brand">
        <span class="mzj-badge"><i class="fa-solid fa-star"></i></span>
        <div>
          <div class="mzj-brand-title">معرض محمد بن ذعار العجمي للسيارات</div>
          <div class="mzj-brand-sub">إدارة المبيعات</div>
        </div>
      </div>
    </div>
    <div class="mzj-topbar-right">
      <button id="btnRefresh" class="btn btn-primary"><i class="fa-solid fa-rotate"></i> تحديث</button>
      <button id="btnSignOut" class="btn btn-ghost" style="display:none"><i class="fa-solid fa-right-from-bracket"></i> تسجيل الخروج</button>
    </div>
  </header>

  <main class="mzj-container">
    <section class="grid grid-3">
      <div class="card">
        <div class="card-title"><i class="fa-solid fa-list-check"></i> إجمالي الطلبات</div>
        <div class="card-value" id="kpiTotal">—</div>
        <div class="card-sub" id="kpiTotalSub">آخر تحديث: —</div>
      </div>
      <div class="card">
        <div class="card-title"><i class="fa-solid fa-hourglass-half"></i> قيد الإجراء</div>
        <div class="card-value" id="kpiInProgress">—</div>
        <div class="card-sub">طلبات حالتها ليست مكتملة</div>
      </div>
      <div class="card">
        <div class="card-title"><i class="fa-brands fa-whatsapp"></i> رسائل مرسلة اليوم</div>
        <div class="card-value" id="kpiSentToday">—</div>
        <div class="card-sub">يُحتسب من سجل النشاط إذا كان موجودًا</div>
      </div>
    </section>

    <section class="card mt">
      <div class="card-head">
        <div class="card-head-left">
          <div class="h2">كل الطلبات</div>
          <div class="muted">مرتّبة بالأحدث (آخر تحديث / إنشاء)</div>
        </div>
        <div class="card-head-right">
          <div class="segmented" role="tablist">
            <button class="seg active" data-filter="all">الكل</button>
            <button class="seg" data-filter="inProgress">قيد الإجراء</button>
            <button class="seg" data-filter="done">مكتملة</button>
          </div>
          <div class="search">
            <i class="fa-solid fa-magnifying-glass"></i>
            <input id="q" type="search" placeholder="ابحث: اسم العميل / رقم الهيكل / رقم الطلب..." />
          </div>
        </div>
      </div>

      <div class="table-wrap">
        <table class="table" id="ordersTable">
          <thead>
            <tr>
              <th>#</th>
              <th>العميل</th>
              <th>السيارة</th>
              <th>رقم الهيكل</th>
              <th>الحالة</th>
              <th>آخر تحديث</th>
              <th style="width:240px">إجراءات</th>
            </tr>
          </thead>
          <tbody id="ordersTbody">
            <tr><td colspan="7" class="muted center">جاري التحميل…</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Details Drawer -->
    <section class="drawer" id="drawer" aria-hidden="true">
      <div class="drawer-backdrop" data-close="drawer"></div>
      <div class="drawer-panel">
        <div class="drawer-head">
          <div>
            <div class="drawer-title" id="dTitle">تفاصيل الطلب</div>
            <div class="drawer-sub" id="dSub">—</div>
          </div>
          <button class="btn btn-ghost" data-close="drawer"><i class="fa-solid fa-xmark"></i></button>
        </div>

        <div class="drawer-body">
          <div class="grid grid-2">
            <div class="info">
              <div class="info-k">اسم العميل</div>
              <div class="info-v" id="dCustomer">—</div>
            </div>
            <div class="info">
              <div class="info-k">رقم الجوال</div>
              <div class="info-v" id="dPhone">—</div>
            </div>
            <div class="info">
              <div class="info-k">السيارة</div>
              <div class="info-v" id="dCar">—</div>
            </div>
            <div class="info">
              <div class="info-k">رقم الهيكل</div>
              <div class="info-v mono" id="dVin">—</div>
            </div>
          </div>

          <div class="divider"></div>

          <div class="h3">سجل النشاط</div>
          <div class="muted mb">يعرض كل ما تم على الطلب (إن كان لديك collection للّوج).</div>
          <div class="log" id="dLog"></div>

          <div class="divider"></div>

          <div class="h3">قوالب الرسائل</div>
          <div class="muted mb">اختار رسالة جاهزة، وعدّل لو حبيت، ثم إرسال.</div>

          <div class="message-box">
            <div class="message-actions">
              <button class="btn btn-outline" id="btnMsgStep1"><i class="fa-solid fa-paper-plane"></i> إرسال رسالة (الخطوة 1)</button>
              <button class="btn btn-outline" id="btnCopyLink"><i class="fa-solid fa-link"></i> نسخ رابط التتبع</button>
            </div>
            <textarea id="msgText" rows="10" placeholder="نص الرسالة..."></textarea>

            <div class="send-row">
              <div class="muted">الإرسال يتم عبر API إذا تم ضبطه (sales.js).</div>
              <button class="btn btn-primary" id="btnSendNow"><i class="fa-brands fa-whatsapp"></i> إرسال الآن</button>
            </div>
          </div>

          <div class="note">
            <div class="note-title"><i class="fa-solid fa-circle-info"></i> ملاحظة</div>
            <div class="note-body">
              إذا الصفحة فتحت عندك لكن ما في طلبات: غالبًا اسم الـ Collection مختلف عندك. عدّله من <span class="mono">sales.js</span> في المتغير <span class="mono">COLLECTION_CANDIDATES</span>.
            </div>
          </div>

        </div>
      </div>
    </section>

    <!-- Toast -->
    <div class="toast" id="toast" aria-live="polite" aria-atomic="true"></div>
  </main>

  <!-- Firebase + App JS (no inline code) -->
  <script src="mzj-ui (1).js"></script>
  <script type="module" src="sales.js"></script>
</body>
</html>
